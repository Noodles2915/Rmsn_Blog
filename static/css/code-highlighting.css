/* Code highlighting styles for Pygments â€” supports day/night modes
   Usage: include this file after main theme.css. It respects
   prefers-color-scheme and a `.theme-dark` or `body.theme-dark` class.
*/

:root {
  /* Default to the site's theme variables so code blocks follow the global theme */
  --code-bg: var(--hover-bg, #f6f8fa);
  --code-text: var(--text, #24292e);
  --code-border: var(--border, #e1e4e8);
  --code-muted: var(--text-secondary, #6a737d);
  --code-keyword: var(--accent, #a71d5d);
  --code-function: var(--accent, #005cc5);
  --code-string: var(--success, #032f2f);
  --code-number: var(--accent, #005cc5);
  --code-comment: var(--text-secondary, #6a737d);
  --code-highlight-line: rgba(27,31,35,0.05);
}

/* Ensure post content code blocks follow theme variables and override base.css rules */
.post-content .codehilite,
.post-content pre,
.post-content pre code,
.post-content pre.hl,
.post-content pre.highlight {
  background: var(--code-bg) !important;
  color: var(--code-text) !important;
  border: 1px solid var(--code-border) !important;
  padding: 12px !important;
  border-radius: 8px !important;
}

.post-content .codehilite pre {
  background: transparent !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Respect user/OS dark preference but prefer explicit theme switching via data-theme */
@media (prefers-color-scheme: dark) {
  :root {
    --code-bg: color-mix(in srgb, var(--hover-bg, #0b1220) 60%, transparent);
    --code-text: var(--text, #d6deeb);
    --code-border: var(--border, #122033);
    --code-muted: var(--text-secondary, #8b96a8);
    --code-keyword: var(--accent, #ff86a3);
    --code-function: var(--accent, #8bd8ff);
    --code-string: var(--success, #94d7a2);
    --code-number: var(--accent, #d19a66);
    --code-comment: var(--text-secondary, #6b7280);
    --code-highlight-line: rgba(255,255,255,0.02);
  }
}

/* Honor the site's explicit theme toggle which uses data-theme on the root element */
[data-theme="dark"] {
  --code-bg: rgba(255,255,255,0.02);
  --code-text: var(--text, #d6deeb);
  --code-border: rgba(255,255,255,0.04);
  --code-muted: var(--text-secondary, #8b96a8);
  --code-keyword: var(--accent, #ff86a3);
  --code-function: var(--accent, #8bd8ff);
  --code-string: var(--success, #94d7a2);
  --code-number: var(--accent, #d19a66);
  --code-comment: var(--text-secondary, #6b7280);
  --code-highlight-line: rgba(255,255,255,0.02);
}

/* Allow an explicit theme toggle via `body.theme-dark` for compatibility */
body.theme-dark {
  --code-bg: rgba(255,255,255,0.02);
  --code-text: var(--text, #d6deeb);
  --code-border: rgba(255,255,255,0.04);
  --code-muted: var(--text-secondary, #8b96a8);
  --code-keyword: var(--accent, #ff86a3);
  --code-function: var(--accent, #8bd8ff);
  --code-string: var(--success, #94d7a2);
  --code-number: var(--accent, #d19a66);
  --code-comment: var(--text-secondary, #6b7280);
  --code-highlight-line: rgba(255,255,255,0.02);
}

/* Base container */
.highlight, pre, code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
}

/* Block code */
pre.highlight, .highlight pre {
  background: var(--code-bg);
  color: var(--code-text);
  border: 1px solid var(--code-border);
  border-radius: 6px;
  padding: 12px 14px;
  overflow: auto;
  font-size: 0.92rem;
  line-height: 1.45;
  margin: 0 0 1rem 0;
}

/* Inline code inside paragraphs */
code, kbd, .inline-code {
  background: color-mix(in srgb, var(--code-bg) 70%, transparent);
  color: var(--code-text);
  padding: 0.15rem 0.35rem;
  border-radius: 4px;
  font-size: 0.9em;
}

/* Line highlight (for some Pygments templates / markdown renderers) */
.highlight .hll { background: var(--code-highlight-line); }

/* Basic token colors mapping (covers common Pygments classes) */
.highlight .c, .highlight .cm, .highlight .cp, .highlight .c1, .highlight .cs {
  color: var(--code-comment);
}
.highlight .err { color: #f97583; background: transparent; }
.highlight .k, .highlight .kc, .highlight .kd, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kt {
  color: var(--code-keyword);
  font-weight: 600;
}
.highlight .nf, .highlight .fm, .highlight .function { color: var(--code-function); }
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .se, .highlight .sh, .highlight .si, .highlight .sx, .highlight .sr, .highlight .s1, .highlight .ss {
  color: var(--code-string);
}
.highlight .m, .highlight .mi, .highlight .mf, .highlight .mh, .highlight .mo { color: var(--code-number); }
.highlight .o, .highlight .p { color: var(--code-text); }
.highlight .n, .highlight .na, .highlight .nb, .highlight .nc, .highlight .nn, .highlight .nt, .highlight .nv {
  color: #e6b673;
}

/* Line numbers (Pygments 'linenos') */
.highlight .linenos {
  padding-right: 12px;
  border-right: 1px solid var(--code-border);
  margin-right: 12px;
  color: var(--code-muted);
}
.highlight .linenos pre {
  color: var(--code-muted);
  background: transparent;
  padding: 0;
  margin: 0;
}

/* When Pygments outputs a table with two columns (linenos + code) */
.highlighttable { width: 100%; border-collapse: collapse; }
.highlighttable td { vertical-align: top; }

/* Scoped improvements for small screens */
@media (max-width: 600px) {
  pre.highlight { font-size: 0.85rem; }
}

/* Accessibility: high contrast focus for keyboard users */
pre:focus, pre code:focus {
  outline: 3px solid color-mix(in srgb, var(--code-text) 20%, transparent);
  outline-offset: 2px;
}

/* A tiny helper class for forcing light variant inside dark pages */
.code-scheme-light {
  --code-bg: #fbfdfd;
  --code-text: #111316;
  --code-border: #e7e9ec;
  --code-muted: #6d7781;
}
