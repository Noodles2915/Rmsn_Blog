/* 主题变量增强和深色模式适配 */

/* 全局字体设定：优先使用微软雅黑 */
html, body {
    font-family: "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
}

/* 强制全站使用微软雅黑（覆盖其他局部 font-family，包括 code/monospace） */

*::before,
*::after {
    font-family: "Microsoft YaHei", "微软雅黑", "Microsoft YaHei UI", Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* 表单控件使用界面无衬线字体以保持一致性 */
input,
textarea,
select,
button {
    font-family: "Microsoft YaHei", "微软雅黑", "Microsoft YaHei UI", Arial, sans-serif;
}

/* 代码块使用等宽字体，确保 Markdown 代码块正常显示并保留空白 */
code,
pre,
kbd,
samp {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Helvetica Neue", monospace !important;
    white-space: pre;
}

/* Header */
header {
    background: var(--header-bg);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 1px 3px var(--shadow);
}

/* 徽章 */
.icon-link .badge {
    background: var(--error);
    color: var(--error-contrast);
}

/* 用户菜单 */
.user-menu {
    background: var(--card);
    color: var(--text);
    box-shadow: 0 6px 12px var(--shadow);
}

.user-menu-item:hover {
    background: var(--hover-bg);
}

/* 按钮样式 */
.btn {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
    transition: all 0.2s ease;
}

.btn:hover {
    background: var(--hover-bg);
    border-color: var(--accent);
    /* 明确设置悬停时文字颜色，避免浅色背景与浅色文字造成不可读 */
    color: var(--text);
}

.btn-primary {
    background: var(--accent);
    color: var(--error-contrast);
    border: 1px solid var(--accent);
}

.btn-primary:hover {
    background: var(--accent-hover);
    border-color: var(--accent-hover);
    color: var(--on-accent) !important;
}

/* Ensure buttons placed on strong/accented backgrounds remain readable */
.card-header .btn,
.content-header .btn,
.header .action-btn.theme-toggle,
.nav-shortcut .action-btn.theme-toggle,
.user-menu .action-btn {
    color: var(--on-accent) !important;
}

/* Fix: in light/day theme the theme-toggle in header should use regular text color */
body:not([data-theme="dark"]) .header .action-btn.theme-toggle,
body:not([data-theme="dark"]) .nav-shortcut .action-btn.theme-toggle {
    color: var(--text) !important;
}

/* Fix: labels used as buttons inside forms were being overridden by .form-group label */
/* Ensure label elements that act as buttons get button color semantics */
.form-group label.btn-primary,
.form-group label.btn.btn-primary {
    color: var(--on-accent) !important;
}
.form-group label.btn-secondary,
.form-group label.btn.btn-secondary {
    color: var(--text) !important;
}
.form-group label.btn-danger,
.form-group label.btn.btn-danger {
    color: var(--error-contrast) !important;
}

.btn-secondary {
    background: var(--hover-bg);
    color: var(--text);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--accent);
    color: var(--text);
}

.btn-danger {
    background: var(--error);
    color: var(--error-contrast);
    border: 1px solid var(--error);
}

.btn-danger:hover {
    background: #dc2626;
    border-color: #dc2626;
}

.btn.liked {
    background: var(--error);
    color: var(--error-contrast);
    box-shadow: 0 6px 18px rgba(239, 68, 68, 0.12);
}

.btn.liked .like-icon {
    color: var(--error-contrast) !important;
}

.btn[aria-pressed="true"] {
    background: var(--hover-bg);
    color: var(--text);
    border: 1px solid var(--border);
}
/* 当已按下/切换态悬停时，确保文字仍然可见 */
.btn[aria-pressed="true"]:hover { color: var(--text); }

.btn.follow {
    background: var(--accent);
    color: var(--on-accent);
    border: 1px solid var(--accent);
}

/* 卡片 */
.card {
    background: var(--card);
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px var(--shadow);
}

.card:hover {
    box-shadow: 0 2px 8px var(--shadow);
}

.card h3 a {
    color: var(--text);
}

/* 表单输入 */
.form-input,
.search-input,
input[type="text"],
input[type="email"],
input[type="password"],
textarea,
select {
    background: var(--input-bg);
    color: var(--text);
    border: 1px solid var(--input-border);
}

.form-input:focus,
.search-input:focus,
input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
    border-color: var(--accent);
    outline: none;
}

.form-input-readonly {
    background: var(--hover-bg);
    color: var(--text);
    border: 1px solid var(--border);
}

/* 链接 */
a {
    color: var(--accent);
}

a:hover {
    color: var(--accent-hover);
}

/* 不在按钮、卡片或下拉菜单中显示蓝色下划线：移除文本装饰并处理聚焦样式 */
.btn a,
.card a,
.user-menu a,
.nav-shortcut a,
.action-btn a,
.dropdown-menu a,
.dropdown-item a {
    text-decoration: none;
}

/* 确保在聚焦/激活时不出现默认蓝色下划线或装饰，但保留 focus-visible 可见性 */
.btn a:focus,
.card a:focus,
.user-menu a:focus,
.nav-shortcut a:focus,
.action-btn a:focus,
.dropdown-menu a:focus,
.dropdown-item a:focus,
.btn:focus,
.card:focus,
.dropdown-item:focus {
    text-decoration: none;
    outline: none;
    box-shadow: none;
}

/* 可访问的自定义聚焦环（当用户使用键盘时显示） */
.btn:focus-visible,
.card:focus-visible,
.dropdown-item:focus-visible,
.action-btn:focus-visible {
    box-shadow: 0 0 0 3px rgba(59,130,246,0.18);
    outline: none;
}

/* 错误消息 */
.error-list {
    color: var(--error);
    background: rgba(239, 68, 68, 0.08);
    border-left: 3px solid var(--error);
}

.error-message,
.error {
    color: var(--error);
}

/* 成功消息 */
.success-message,
.success {
    color: var(--success);
}

/* 标题和文本 */
h1, h2, h3, h4, h5, h6 {
    color: var(--text);
}

p {
    color: var(--text);
}

.text-muted {
    color: var(--text-secondary);
}

.help-text {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

/* 分割线 */
hr {
    border: none;
    border-top: 1px solid var(--border);
}

/* 代码块 */
code {
    background: transparent;
    color: var(--text);
}

pre,
pre code {
    background: var(--hover-bg);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 12px;
    border-radius: 8px;
    overflow: auto;
    white-space: pre;
}

/* Dark theme: use darker background for code blocks */
[data-theme="dark"] pre,
[data-theme="dark"] pre code {
    background: rgba(255,255,255,0.02);
    border-color: rgba(255,255,255,0.04);
}

/* Pygments output wrapper (server-side highlighted) */
.codehilite {
    background: var(--hover-bg);
    border: 1px solid var(--border);
    padding: 12px;
    border-radius: 8px;
    overflow: auto;
}
.codehilite pre { background: transparent; margin: 0; padding: 0; color: inherit; }
.codehilite .highlight { background: transparent; }

/* Allow token colors within codehilite to show (don't force color on all children) */
.codehilite span { color: inherit; }

/* Dark theme adjustments for highlighted code */
[data-theme="dark"] .codehilite {
    background: rgba(255,255,255,0.02);
    border-color: rgba(255,255,255,0.04);
}

/* 评论 */
.comment {
    background: var(--card);
    border: 1px solid var(--border);
}

.comment-author {
    color: var(--text);
}

.comment-time {
    color: var(--text-secondary);
}

/* 标签 */
.tag {
    background: var(--hover-bg);
    color: var(--accent);
    border: 1px solid var(--border);
}

.tag:hover {
    background: var(--accent);
    color: var(--error-contrast);
    border-color: var(--accent);
}

/* 输入框占位符 */
input::placeholder,
textarea::placeholder {
    color: var(--text-secondary);
}

/* 滚动条 */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg);
}

::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
}

/* 模态框 */
.modal {
    background: var(--card);
    border: 1px solid var(--border);
    box-shadow: 0 20px 25px -5px var(--shadow);
}

.modal-backdrop {
    background: rgba(0, 0, 0, 0.5);
}

/* 表格 */
table {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
}

table thead {
    background: var(--hover-bg);
}

table td, table th {
    border-bottom: 1px solid var(--border);
}

/* 主题切换按钮样式 */
.theme-toggle {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text);
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
}

.theme-toggle:hover {
    background: var(--hover-bg);
    border-color: var(--accent);
}

/* 动画和过渡 */
* {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* 禁用过渡以避免闪烁 */
input,
textarea,
select {
    transition: none;
}

/* Toast UI (moved from template) */
#toast-container { position: fixed; right: 16px; bottom: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; pointer-events: none; }
.toast { pointer-events: auto; min-width: 200px; max-width: 360px; padding: 10px 14px; border-radius: 8px; color: #fff; box-shadow: 0 6px 18px rgba(2,6,23,0.24); opacity: 0; transform: translateY(12px) scale(0.98); font-weight: 600; }

@keyframes toast-in {
    0% { opacity: 0; transform: translateY(12px) scale(0.98); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes toast-out {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(12px) scale(0.98); }
}
.toast.enter { animation: toast-in 280ms cubic-bezier(.2,.9,.3,1) forwards; }
.toast.leave { animation: toast-out 220ms ease forwards; }
.toast.info { background: linear-gradient(90deg,#111827,#1f2937); }
.toast.success { background: linear-gradient(90deg,#059669,#10b981); }
.toast.error { background: linear-gradient(90deg,#dc2626,#ef4444); }


/* Auth pages: full-screen custom background with frosted glass card */
.auth-bg {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px 24px;
    z-index: 0;
    /* --auth-bg-image can be set inline on the element to customize background */
}
.auth-bg::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -1;
    background-image: var(--auth-bg-image, linear-gradient(135deg, rgba(59,130,246,0.08), rgba(99,102,241,0.06)));
    background-size: cover;
    background-position: center;
    filter: saturate(110%) contrast(95%);
}
.auth-bg::after {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -1;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.06));
    mix-blend-mode: overlay;
    pointer-events: none;
}

.glass-card {
    width: 100%;
    max-width: 520px;
    border-radius: 14px;
    padding: 28px 28px;
    box-shadow: 0 12px 32px rgba(2,6,23,0.18);
    background: rgba(255,255,255,0.36);
    border: 1px solid rgba(255,255,255,0.12);
    backdrop-filter: blur(12px) saturate(120%);
    -webkit-backdrop-filter: blur(12px) saturate(120%);
    z-index: 1;
}

/* Dark theme adjustments */
[data-theme="dark"] .glass-card {
    background: rgba(18,24,36,0.42);
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: 0 12px 34px rgba(2,6,23,0.48);
}

.container-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.container-form h1 { font-size: 22px; margin-bottom: 6px; color: var(--text); }
.container-form label { display: block; margin-bottom: 6px; color: var(--text-secondary); font-weight: 600; }
.container-form input[type="text"],
.container-form input[type="email"],
.container-form input[type="password"],
.container-form .vcode-input {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,0.06);
    background: rgba(255,255,255,0.6);
    color: var(--text);
}

[data-theme="dark"] .container-form input[type="text"],
[data-theme="dark"] .container-form input[type="email"],
[data-theme="dark"] .container-form input[type="password"],
[data-theme="dark"] .container-form .vcode-input {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.04);
    color: var(--text);
}

.flex-row { display: flex; gap: 8px; align-items: center; }
.vcode-input { flex: 1; }
.container-form .btn { padding: 10px 14px; border-radius: 10px; }
.container-form .foot { margin-top: 12px; color: var(--text-secondary); font-size: 14px; }

@media (max-width: 520px) {
    .glass-card { padding: 20px; border-radius: 12px; }
}
